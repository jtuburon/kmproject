{% load lessons_extras %}
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i>Tecnosystems' Lessons Learned
                <button type="button" onClick="javascript:new_lesson();" class="btn btn-primary">New Lesson</button>
            </div>
            <nav>
                <ul class="pagination">
                    <li>
                        {% if lessons_list.has_previous %}
                            <a href="javascript:filter_lessons({{ lessons_list.previous_page_number }})" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        {% else %}
                            <span aria-hidden="true">&laquo;</span>
                        {% endif %}
                    </li>
                    <li>
                        <span class="current">
                            Page {{ lessons_list.number }} of {{ lessons_list.paginator.num_pages }}.
                        </span>
                    </li>
                    <li>
                        {% if lessons_list.has_next %}
                            <a href="javascript:filter_lessons({{ lessons_list.next_page_number }})" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        {% else %}
                            <span aria-hidden="true">&raquo;</span>
                        {% endif %}
                    </li>
                </ul>
            </nav>

            <div class="panel-body">
                <ul class="timeline">
                    {% for l in lessons_list %}
                        <li class="{% cycle '' 'timeline-inverted' %}">
                            <div class="timeline-badge info">&nbsp<i class="fa fa-credit-card"></i>&nbsp</div>
                            <div class="timeline-panel">
                                <div class="timeline-heading">
                                    <input id="stars-input-{{l.number}}" class="rating rating-loading" data-min="0" data-max="5" data-step="0.1" data-size="xs" value=3 data-readonly="true">
                                    <hr>                        
                                    <p><small class="text-muted"><i class="fa fa-clock-o"></i>{{l.pub_date}}</small> {% fullname l.author%}
                                    </p>
                                    <h4 class="timeline-title"><a href="javascript:lesson_show({{l.number}})">Lesson No: {{l.number}} - {{l.title}}</a></h4>
                                </div>
                                <div class="timeline-body">
                                    <p>
                                    {% autoescape off%}
                                        {{l.problem}}
                                    {% endautoescape %}
                                    </p>
                                    <hr>
                                    {% if l.hits_count %}
                                        <p>
                                            <b>Hits Count:</b>  {{l.hits_count}}  of {{l.tags|length}}  tags.
                                        </p>
                                    {% endif %}                                    

                                    <div id="lessontags-{{l.number}}" class="tag-list"></div>
                                    
                                    <div class="rate-input-container">
                                        <br>
                                        <label for="rate-input-{{l.number}}" class="control-label">Rate This Lesson</label>
                                        <input id="rate-input-{{l.number}}" class="rating rating-loading" data-min="0" data-max="5" data-step="0.1" data-size="xs">
                                        <br>
                                        <div id="rate-info-{{l.number}}" class="alert alert-success" style="display:none;width:60%">
                                          <strong>Lesson rated succesfully!!</strong>
                                        </div>
                                    </div>
                                    <script>
                                        function setCaption(value){
                                            return value;
                                        }

                                        $(function() {
                                            $('#stars-input-{{l.number}}').rating({starCaptions: setCaption});
                                            $('#rate-input-{{l.number}}').rating({starCaptions: setCaption});

                                            $('#lessontags-{{l.number}}').tags({
                                                tagData: {% autoescape off%}{% resulttagslabels l %} {% endautoescape %},
                                                readOnly: true,
                                                tagSize: "sm"
                                            });

                                            $('#rate-input-{{l.number}}').on(
                                                'rating.change', 
                                                function(event, value, caption) {
                                                    lesson_rate({{l.number}}, value);
                                                }
                                            );

                                        });
                                    </script>                                
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
